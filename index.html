<!doctype html>
<html lang="vi" data-theme="dark">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <meta name="description" content="Media Player + AI English Learning Platform" />
  <meta name="keywords" content="English Learning, Music, Lyrics, AI, Quiz" />
  <meta name="author" content="Tr·∫ßn Qu·ªëc Trung" />
  <title>Media ‚Ä¢ AI English Learning</title>

  <style>
    /* ========== RESET + BASE ========== */
    *{margin:0;padding:0;box-sizing:border-box}
    html{scroll-behavior:smooth}
    body{
      min-height:100vh;
      font-family: system-ui, -apple-system, "Segoe UI", Roboto, Arial, sans-serif;
      background:
        radial-gradient(900px 500px at 15% 10%, rgba(255,59,59,.18), transparent 55%),
        radial-gradient(900px 500px at 80% 20%, rgba(255,213,74,.14), transparent 60%),
        radial-gradient(700px 500px at 40% 85%, rgba(74,144,255,.10), transparent 55%),
        linear-gradient(180deg, #05070c 0%, #070A10 100%);
      color: rgba(255,255,255,.92);
      overflow-x:hidden;
    }
    :root{
      --bg:#070A10; --txt:rgba(255,255,255,.92);
      --muted:rgba(255,255,255,.68); --muted2:rgba(255,255,255,.56);
      --panel:rgba(255,255,255,.06); --panel2:rgba(255,255,255,.08);
      --line:rgba(255,255,255,.12);
      --brand:#ff3b3b; --brand2:#ffd54a;
      --radius:18px;
      --shadow:0 18px 60px rgba(0,0,0,.55);
      --ring:0 0 0 4px rgba(255,59,59,.14);
      --ease:.18s ease;
      --max:1160px;
    }
    [data-theme="light"]{
      --bg:#f6f7fb; --txt:rgba(0,0,0,.88);
      --muted:rgba(0,0,0,.64); --muted2:rgba(0,0,0,.52);
      --panel:rgba(0,0,0,.04); --panel2:rgba(0,0,0,.06);
      --line:rgba(0,0,0,.10);
      --shadow:0 18px 60px rgba(0,0,0,.14);
      --ring:0 0 0 4px rgba(255,59,59,.18);
    }

    /* ========== LAYOUT ========== */
    .wrap{max-width:var(--max);margin:0 auto;padding:0 18px}
    .grid{display:grid;gap:16px}
    .card{
      background: linear-gradient(180deg, var(--panel) 0%, rgba(255,255,255,.04) 100%);
      border:1px solid var(--line);
      border-radius:var(--radius);
      box-shadow:var(--shadow);
      backdrop-filter: blur(12px);
    }
    .pad{padding:18px}
    .muted{color:var(--muted)}
    .muted2{color:var(--muted2)}
    .bold{font-weight:900}
    .pill{
      display:inline-flex;align-items:center;gap:8px;
      padding:8px 12px;border-radius:999px;
      border:1px solid var(--line);
      background:rgba(255,255,255,.04);
      color:var(--muted);
      font-weight:800;font-size:13px;
      white-space:nowrap;
    }
    .dot{width:8px;height:8px;border-radius:999px;background:linear-gradient(135deg,var(--brand),var(--brand2));
      box-shadow:0 0 0 4px rgba(255,59,59,.12)
    }

    /* ========== HEADER ========== */
    header{
      position:sticky;top:0;z-index:50;
      background: rgba(7,10,16,.62);
      border-bottom:1px solid rgba(255,255,255,.08);
      backdrop-filter: blur(10px);
    }
    [data-theme="light"] header{background: rgba(255,255,255,.75);border-bottom:1px solid rgba(0,0,0,.08)}
    .nav{display:flex;align-items:center;justify-content:space-between;padding:12px 0;gap:12px}
    .brandWrap{display:flex;align-items:center;gap:10px}
    .brandBadge{
      width:36px;height:36px;border-radius:14px;display:grid;place-items:center;
      background:linear-gradient(135deg, rgba(255,59,59,.22), rgba(255,213,74,.18));
      border:1px solid rgba(255,255,255,.14);
      box-shadow:0 14px 40px rgba(0,0,0,.18);
      flex:0 0 auto;
    }
    .brandBadge span{
      font-weight:900;background:linear-gradient(135deg,var(--brand),var(--brand2));
      -webkit-background-clip:text;background-clip:text;color:transparent;letter-spacing:.4px;
    }
    .brandTitle{font-weight:900;font-size:14px;line-height:1.15}
    .brandSub{font-weight:800;font-size:12px;color:var(--muted2)}
    .actions{display:flex;align-items:center;gap:8px}
    .iconBtn{
      display:inline-flex;align-items:center;justify-content:center;
      width:40px;height:40px;border-radius:14px;
      border:1px solid var(--line);background:rgba(255,255,255,.04);
      cursor:pointer;transition:var(--ease);user-select:none;
    }
    .iconBtn:hover{transform:translateY(-1px);background:rgba(255,255,255,.06)}
    .iconBtn:focus{outline:none;box-shadow:var(--ring)}

    /* ========== CONTROLS + INPUTS ========== */
    .input{
      padding:11px 12px;border-radius:14px;border:1px solid var(--line);
      background:rgba(255,255,255,.04);color:var(--txt);
      font-weight:800;font-size:13px;outline:none;min-width:220px;
    }
    .miniBtn{
      display:inline-flex;align-items:center;justify-content:center;gap:8px;
      padding:10px 12px;border-radius:14px;border:1px solid var(--line);
      background:rgba(255,255,255,.04);
      cursor:pointer;font-weight:900;font-size:12.5px;transition:var(--ease);
    }
    .miniBtn:hover{background:rgba(255,255,255,.06)}
    .miniBtn:focus{outline:none;box-shadow:var(--ring)}
    .row{display:flex;gap:10px;flex-wrap:wrap;align-items:center}
    .spacer{height:10px}

    /* ========== MEDIA UI ========== */
    .mediaGrid{grid-template-columns: 1.05fr .95fr;align-items:stretch}
    .playerBox{
      border:1px solid var(--line);border-radius:18px;background:rgba(255,255,255,.03);overflow:hidden;
    }
    .playerBox iframe{width:100%;height:420px;border:0;display:block;background:#000}
    .nowBox{display:flex;flex-direction:column;gap:6px}
    .nowLine{display:flex;gap:10px;flex-wrap:wrap;align-items:center}
    .nowLine b{font-size:14px}
    .badge{
      font-size:11px;font-weight:900;padding:7px 10px;border-radius:999px;
      border:1px solid rgba(255,255,255,.14);
      background:rgba(255,255,255,.04);color:var(--muted);white-space:nowrap;
    }
    .badge.red{border-color: rgba(255,59,59,.25)}
    .badge.yellow{border-color: rgba(255,213,74,.25)}
    .playlistTools{display:flex;gap:10px;flex-wrap:wrap;align-items:center}
    .playlistScroll{max-height:520px;overflow:auto;padding-right:6px}
    .playlist{display:grid;gap:10px}
    .track{
      border:1px solid var(--line);border-radius:16px;background:rgba(255,255,255,.04);
      padding:12px;cursor:pointer;transition:var(--ease);display:grid;gap:6px;
    }
    .track:hover{transform:translateY(-1px);background:rgba(255,255,255,.06)}
    .track.active{
      border-color: rgba(255,59,59,.35);
      background:linear-gradient(135deg, rgba(255,59,59,.18), rgba(255,213,74,.10));
    }
    .trackTop{display:flex;justify-content:space-between;gap:10px;align-items:center}
    .trackTitle{font-weight:900;font-size:13px}
    .trackMeta{color:var(--muted2);font-weight:900;font-size:11px;letter-spacing:.6px;text-transform:uppercase}
    .trackDesc{color:var(--muted);font-size:12.5px;line-height:1.55}

    /* Lyrics */
    .lyricBox{margin-top:12px;border:1px solid var(--line);border-radius:18px;background:rgba(255,255,255,.03);overflow:hidden}
    .lyricHead{padding:12px 14px;display:flex;justify-content:space-between;align-items:center;gap:10px;border-bottom:1px solid rgba(255,255,255,.10)}
    .lyricHead b{font-weight:900;font-size:13px}
    .lyricHint{color:var(--muted2);font-weight:800;font-size:12px;white-space:nowrap}
    .lyricBody{padding:12px 14px;display:grid;gap:10px}
    .lyricText{
      width:100%;min-height:140px;resize:vertical;border-radius:14px;border:1px solid var(--line);
      background:rgba(255,255,255,.04);color:var(--txt);font-weight:800;font-size:13px;outline:none;
      line-height:1.6;padding:12px;
    }
    .lyricActions{display:flex;gap:10px;flex-wrap:wrap}

    /* Toast */
    .toast{
      position:fixed;right:16px;bottom:16px;padding:12px 14px;border-radius:16px;
      border:1px solid var(--line);background:rgba(0,0,0,.65);color:rgba(255,255,255,.92);
      font-weight:900;display:none;z-index:120;backdrop-filter: blur(10px);max-width: 320px;
    }
    [data-theme="light"] .toast{background:rgba(255,255,255,.85);color:rgba(0,0,0,.88)}
    .toast.show{display:block}

    @media (max-width: 1040px){
      .mediaGrid{grid-template-columns:1fr}
      .playerBox iframe{height:320px}
      .playlistScroll{max-height:420px}
    }
    @media (max-width: 560px){
      .playerBox iframe{height:240px}
      .playlistScroll{max-height:320px}
      .actions{display:none}
    }
  </style>
</head>

<body>
  <header>
    <div class="wrap">
      <div class="nav">
        <div class="brandWrap">
          <div class="brandBadge" aria-hidden="true"><span>MV</span></div>
          <div>
            <div class="brandTitle">üéß Media ‚Ä¢ AI English Learning</div>
            <div class="brandSub">Learn English through Music, Lyrics & Practice</div>
          </div>
        </div>

        <div class="actions">
          <button id="btnTheme" class="iconBtn" title="ƒê·ªïi theme (Dark/Light)">üåì</button>
        </div>
      </div>
    </div>
  </header>

  <main class="wrap" style="padding:18px 0 28px;">
    <div class="row" style="margin-bottom:12px;">
      <span class="pill"><span class="dot"></span> Player + Playlist + Lyrics (EN/VI)</span>
      <span class="pill">‚úÖ L∆∞u d·ªØ li·ªáu b·∫±ng LocalStorage</span>
    </div>

    <div class="grid mediaGrid">
      <!-- LEFT: Player -->
      <section class="card pad">
        <div class="nowBox">
          <div class="nowLine">
            <b id="nowTitle">Ch∆∞a ch·ªçn b√†i</b>
            <span id="nowType" class="badge red">MUSIC</span>
            <span id="nowMeta" class="badge yellow">‚Äî</span>
          </div>
          <div class="muted" style="font-size:13px;" id="nowDesc">Ch·ªçn 1 b√†i ·ªü playlist b√™n ph·∫£i ƒë·ªÉ ph√°t.</div>
        </div>

        <div class="spacer"></div>

        <div class="playerBox">
          <iframe id="ytPlayer"
                  title="YouTube Player"
                  src="about:blank"
                  allow="autoplay; encrypted-media"
                  allowfullscreen></iframe>
        </div>

        <div class="spacer"></div>

        <div class="row">
          <button id="btnPrev" class="miniBtn">‚èÆ Prev</button>
          <button id="btnNext" class="miniBtn">‚è≠ Next</button>
          <button id="btnShuffle" class="miniBtn" aria-pressed="false">üîÄ Shuffle: OFF</button>
          <button id="btnRepeat" class="miniBtn" aria-pressed="false">üîÅ Repeat One: OFF</button>
          <button id="btnCopyLink" class="miniBtn">üîó Copy Link</button>
        </div>

        <div class="lyricBox">
          <div class="lyricHead">
            <b>üìù Lyrics (EN / VI)</b>
            <span class="lyricHint">Tip: Save theo t·ª´ng b√†i</span>
          </div>
          <div class="lyricBody">
            <textarea id="lyricEN" class="lyricText" placeholder="Lyrics English..."></textarea>
            <textarea id="lyricVI" class="lyricText" placeholder="L·ªùi ti·∫øng Vi·ªát..."></textarea>
            <div class="lyricActions">
              <button id="btnSaveLyric" class="miniBtn">üíæ Save Lyrics</button>
              <button id="btnLoadLyric" class="miniBtn">üì• Load Lyrics</button>
              <button id="btnClearLyric" class="miniBtn">üßπ Clear Box</button>
            </div>
            <div class="muted2" style="font-size:12px;line-height:1.6">
              L∆∞u √Ω: YouTube iframe kh√¥ng cho ƒë·ªçc ‚ÄúcurrentTime‚Äù, n√™n b·∫£n n√†y kh√¥ng c√≥ ‚ÄúSave time‚Äù.
            </div>
          </div>
        </div>
      </section>

      <!-- RIGHT: Playlist -->
      <aside class="card pad">
        <div class="playlistTools">
          <input id="trackSearch" class="input" placeholder="T√¨m b√†i h√°t (search)..." />
          <span class="badge" id="countBadge">0 tracks</span>
        </div>

        <div class="spacer"></div>

        <div class="playlistScroll">
          <div id="playlist" class="playlist"></div>
        </div>

        <div class="spacer"></div>
        <div class="muted2" style="font-size:12px;line-height:1.6">
          ‚Ä¢ Click 1 track ƒë·ªÉ ph√°t. ‚Ä¢ Search ƒë·ªÉ l·ªçc. ‚Ä¢ Shuffle/Repeat l∆∞u tr·∫°ng th√°i.
        </div>
      </aside>
    </div>
  </main>

  <div id="toast" class="toast" role="status" aria-live="polite"></div>

  <script>
    /* =========================================================
       Media ‚Ä¢ AI English Learning ‚Äî Clean Single-file Version
       Fixes for your doc:
       - T√°ch ƒë√∫ng HTML/CSS/JS (kh√¥ng ƒë·ªÉ CSS/JS n·∫±m ngo√†i </html>)
       - Kh√¥ng l·∫∑p CSS (b·ªè duplicate ‚ÄúPART 2‚Äù)
       - B·ªï sung ƒë·ªß c√°c ID m√† JS g·ªçi: #trackSearch, #nowTitle, #btnPrev...
       - Playlist + Search + Shuffle + Repeat + Lyrics per-track (LocalStorage)
       ========================================================= */

    const $ = (q, root=document) => root.querySelector(q);

    function toast(msg){
      const el = $("#toast");
      if(!el) return alert(msg);
      el.textContent = msg;
      el.classList.add("show");
      clearTimeout(toast._t);
      toast._t = setTimeout(()=> el.classList.remove("show"), 1800);
    }

    function safeJSONParse(str, fallback){
      try{ return JSON.parse(str); }catch(e){ return fallback; }
    }

    function norm(str){
      return (str||"").toString().trim().toLowerCase()
        .normalize("NFD").replace(/[\u0300-\u036f]/g,"");
    }

    // ===== DOM =====
    const ytPlayer   = $("#ytPlayer");
    const playlistEl = $("#playlist");
    const searchEl   = $("#trackSearch");
    const nowTitleEl = $("#nowTitle");
    const nowMetaEl  = $("#nowMeta");
    const nowTypeEl  = $("#nowType");
    const nowDescEl  = $("#nowDesc");
    const countBadge = $("#countBadge");

    const btnPrev    = $("#btnPrev");
    const btnNext    = $("#btnNext");
    const btnShuffle = $("#btnShuffle");
    const btnRepeat  = $("#btnRepeat");
    const btnCopyLink= $("#btnCopyLink");
    const btnTheme   = $("#btnTheme");

    const lyricEnEl  = $("#lyricEN");
    const lyricViEl  = $("#lyricVI");
    const btnSaveLyric = $("#btnSaveLyric");
    const btnLoadLyric = $("#btnLoadLyric");
    const btnClearLyric= $("#btnClearLyric");

    // ===== DATA: minimal default list (you can paste your 100 tracks here) =====
    // N·∫øu b·∫°n ƒë√£ c√≥ list MEDIA trong file c≈©, c·ª© thay TRACKS b√™n d∆∞·ªõi b·∫±ng list ƒë√≥.
    const TRACKS = [
      { type:"MUSIC", title:"Shape of You ‚Äî Ed Sheeran", meta:"US/UK", desc:"Official video", videoId:"JGwWNGJdvx8" },
      { type:"MUSIC", title:"Uptown Funk ‚Äî Mark Ronson ft. Bruno Mars", meta:"US/UK", desc:"Official video", videoId:"OPf0YbXqDm0" },
      { type:"MUSIC", title:"bad guy ‚Äî Billie Eilish", meta:"US/UK", desc:"Official video", videoId:"DyDfgMOUjCI" },
      { type:"MUSIC", title:"Despacito ‚Äî Luis Fonsi ft. Daddy Yankee", meta:"GLOBAL", desc:"Official video", videoId:"kJQP7kiw5Fk" },
      { type:"MUSIC", title:"Gangnam Style ‚Äî PSY", meta:"K-POP", desc:"Official video", videoId:"9bZkp7q19f0" },
      { type:"MUSIC", title:"Faded ‚Äî Alan Walker", meta:"EDM", desc:"Official video", videoId:"60ItHLz5WEA" },
      { type:"MUSIC", title:"Hello ‚Äî Adele", meta:"US/UK", desc:"Official video", videoId:"YQHsXMglC9A" },
      { type:"MUSIC", title:"Waka Waka ‚Äî Shakira", meta:"GLOBAL", desc:"Official video", videoId:"pRpeEdMmmQ0" }
    ];

    // ===== STORAGE KEYS =====
    const LS_STATE  = "mvapp_state_v1";
    const LS_LYRICS = "mvapp_lyrics_store_v1";

    function readState(){
      return safeJSONParse(localStorage.getItem(LS_STATE), {
        idx: 0,
        shuffle: false,
        repeatOne: false,
        theme: document.documentElement.getAttribute("data-theme") || "dark"
      });
    }
    function writeState(s){
      localStorage.setItem(LS_STATE, JSON.stringify(s));
    }
    function readLyricsStore(){
      return safeJSONParse(localStorage.getItem(LS_LYRICS), {});
    }
    function writeLyricsStore(obj){
      localStorage.setItem(LS_LYRICS, JSON.stringify(obj));
    }

    // ===== APP STATE =====
    let state = readState();
    let currentIndex = clampIndex(state.idx);
    let shuffle = !!state.shuffle;
    let repeatOne = !!state.repeatOne;

    function clampIndex(i){
      const n = TRACKS.length || 1;
      i = Number.isFinite(i) ? i : 0;
      if(i < 0) i = 0;
      if(i >= n) i = n - 1;
      return i;
    }

    function setTheme(t){
      document.documentElement.setAttribute("data-theme", t);
      state.theme = t;
      writeState(state);
    }

    function toggleTheme(){
      const cur = document.documentElement.getAttribute("data-theme") || "dark";
      setTheme(cur === "dark" ? "light" : "dark");
      toast("üåì Theme: " + (document.documentElement.getAttribute("data-theme")));
    }

    function buildEmbedUrl(videoId){
      // NOTE: Kh√¥ng th·ªÉ ƒë·ªçc currentTime t·ª´ iframe => kh√¥ng c√≥ save time ·ªü b·∫£n n√†y
      return `https://www.youtube.com/embed/${encodeURIComponent(videoId)}?autoplay=1&rel=0&modestbranding=1`;
    }

    function setNowPlayingUI(track){
      nowTitleEl.textContent = track?.title || "Ch∆∞a ch·ªçn b√†i";
      nowTypeEl.textContent  = track?.type || "MUSIC";
      nowMetaEl.textContent  = track?.meta || "‚Äî";
      nowDescEl.textContent  = track?.desc || "‚Äî";
    }

    function renderPlaylist(filterText=""){
      const f = norm(filterText);
      const list = TRACKS
        .map((t, idx)=> ({...t, idx}))
        .filter(t => !f || norm(t.title + " " + (t.meta||"") + " " + (t.desc||"")).includes(f));

      playlistEl.innerHTML = list.map(t => `
        <div class="track ${t.idx===currentIndex ? "active":""}" data-idx="${t.idx}">
          <div class="trackTop">
            <div class="trackTitle">${escapeHtml(t.title)}</div>
            <div class="trackMeta">${escapeHtml(t.meta || t.type || "MUSIC")}</div>
          </div>
          <p class="trackDesc">${escapeHtml(t.desc || "")}</p>
        </div>
      `).join("");

      countBadge.textContent = `${list.length} / ${TRACKS.length} tracks`;
    }

    function escapeHtml(s){
      return (s ?? "").toString()
        .replaceAll("&","&amp;")
        .replaceAll("<","&lt;")
        .replaceAll(">","&gt;")
        .replaceAll('"',"&quot;")
        .replaceAll("'","&#39;");
    }

    function playByIndex(idx, {silent=false} = {}){
      idx = clampIndex(idx);
      currentIndex = idx;
      state.idx = idx;
      writeState(state);

      const track = TRACKS[idx];
      setNowPlayingUI(track);

      if(track?.videoId){
        ytPlayer.src = buildEmbedUrl(track.videoId);
        if(!silent) toast("‚ñ∂Ô∏è " + track.title);
      }

      renderPlaylist(searchEl?.value || "");
      loadLyricsForCurrentIntoUI(false);
    }

    function nextIndex(){
      if(repeatOne) return currentIndex;

      if(shuffle){
        if(TRACKS.length <= 1) return currentIndex;
        let tries = 0;
        let r = currentIndex;
        while(r === currentIndex && tries < 10){
          r = Math.floor(Math.random() * TRACKS.length);
          tries++;
        }
        return r;
      }
      return (currentIndex + 1) % TRACKS.length;
    }

    function prevIndex(){
      if(repeatOne) return currentIndex;
      if(shuffle) return nextIndex(); // random prev for simplicity
      return (currentIndex - 1 + TRACKS.length) % TRACKS.length;
    }

    function setShuffle(v){
      shuffle = !!v;
      state.shuffle = shuffle;
      writeState(state);
      btnShuffle.setAttribute("aria-pressed", String(shuffle));
      btnShuffle.textContent = shuffle ? "üîÄ Shuffle: ON" : "üîÄ Shuffle: OFF";
    }

    function setRepeatOne(v){
      repeatOne = !!v;
      state.repeatOne = repeatOne;
      writeState(state);
      btnRepeat.setAttribute("aria-pressed", String(repeatOne));
      btnRepeat.textContent = repeatOne ? "üîÅ Repeat One: ON" : "üîÅ Repeat One: OFF";
    }

    async function copyCurrentLink(){
      const t = TRACKS[currentIndex];
      if(!t?.videoId) return toast("‚ùå No track");
      const url = `https://youtu.be/${t.videoId}`;
      try{
        await navigator.clipboard.writeText(url);
        toast("‚úÖ Copied: " + url);
      }catch{
        // fallback
        const ta = document.createElement("textarea");
        ta.value = url;
        document.body.appendChild(ta);
        ta.select();
        document.execCommand("copy");
        ta.remove();
        toast("‚úÖ Copied: " + url);
      }
    }

    // ===== LYRICS STORE (per track) =====
    function currentKey(){
      const t = TRACKS[currentIndex];
      return t?.videoId ? String(t.videoId) : String(currentIndex);
    }

    function loadLyricsForCurrentIntoUI(showToast){
      const store = readLyricsStore();
      const key = currentKey();
      const entry = store[key] || { en:"", vi:"" };
      if(lyricEnEl) lyricEnEl.value = entry.en || "";
      if(lyricViEl) lyricViEl.value = entry.vi || "";
      if(showToast) toast("üì• Loaded lyrics");
    }

    function saveLyricsForCurrentFromUI(){
      const store = readLyricsStore();
      const key = currentKey();
      store[key] = {
        en: lyricEnEl?.value || "",
        vi: lyricViEl?.value || ""
      };
      writeLyricsStore(store);
      toast("üíæ Saved lyrics");
    }

    function clearLyricBoxes(){
      if(lyricEnEl) lyricEnEl.value = "";
      if(lyricViEl) lyricViEl.value = "";
      toast("üßπ Cleared");
    }

    // ===== BIND EVENTS (no dupes) =====
    let BOUND = false;
    function bindOnce(){
      if(BOUND) return;
      BOUND = true;

      btnPrev?.addEventListener("click", ()=> playByIndex(prevIndex()));
      btnNext?.addEventListener("click", ()=> playByIndex(nextIndex()));
      btnShuffle?.addEventListener("click", ()=> setShuffle(!shuffle));
      btnRepeat?.addEventListener("click", ()=> setRepeatOne(!repeatOne));
      btnCopyLink?.addEventListener("click", copyCurrentLink);
      btnTheme?.addEventListener("click", toggleTheme);

      searchEl?.addEventListener("input", ()=> renderPlaylist(searchEl.value));

      playlistEl?.addEventListener("click", (e)=>{
        const card = e.target.closest(".track");
        if(!card) return;
        const idx = Number(card.getAttribute("data-idx"));
        if(Number.isFinite(idx)) playByIndex(idx);
      });

      btnSaveLyric?.addEventListener("click", saveLyricsForCurrentFromUI);
      btnLoadLyric?.addEventListener("click", ()=> loadLyricsForCurrentIntoUI(true));
      btnClearLyric?.addEventListener("click", clearLyricBoxes);
    }

    // ===== INIT =====
    (function init(){
      // Theme
      const startTheme = state.theme || "dark";
      setTheme(startTheme);

      // Buttons state
      setShuffle(shuffle);
      setRepeatOne(repeatOne);

      // Render first
      renderPlaylist("");

      // Bind
      bindOnce();

      // Auto play last track (silent toast)
      playByIndex(currentIndex, {silent:true});
      toast("‚úÖ Ready!");
    })();
  </script>
</body>
</html>
